C51 COMPILER V9.00   MAIN                                                                  08/12/2015 08:22:17 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN MAIN.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE MAIN.C LARGE OPTIMIZE(6,SPEED) BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*
   2          ±¾²âÊÔ³ÌĞòÔÚ°²ĞÅ¿É¿Æ¼¼30Ôª µÄ²âÊÔ°åÉÏÕıÈ·ÔËĞĞ£¬ËùÓĞ°²ĞÅ¿É³öµÄµÄÄ£¿é´ÓESP-01µ½ESP-14¾ù¿ÉÒÔÕıÈ·ÔËĞĞ£¬ÓëÔ¶³Ì¿
             -ØÖÆ¡£
   3          */
   4          #include"SYS.H"
   5          #include"AT_PRC.H"
   6          #include"delay.h"
   7          #include <string.h>
   8          #include <stdio.h> /* for printf */
   9          
  10          extern void PWM(unsigned char r,unsigned char g,unsigned char b);
  11          extern void timer0_ini();
  12          extern bit have_change_pwm;
  13          extern void set_pwm(unsigned char data rr,unsigned char data gg,unsigned char data bb);
  14          extern void read_dh(void);
  15          extern unsigned char uart_time_out;
  16          extern bit uart_rec_date;
  17          extern bit uart_rec_new;
  18          unsigned char bar_r=0;
  19          unsigned char bar_g=0;
  20          unsigned char bar_b=0;
  21          unsigned char old_bar_r=0;
  22          unsigned char old_bar_g=0;
  23          unsigned char old_bar_b=0;
  24          
  25          extern unsigned int delay_1min;
  26          extern unsigned char TP_H;
  27          extern unsigned char TP_L;
  28          extern unsigned char RH_H;
  29          extern unsigned char RH_L;
  30          extern unsigned char CR_D;
  31          extern bit min_rech;
  32          code unsigned char RGB_CODE_R[]="LIGHTR:";
  33          code unsigned char RGB_CODE_G[]="LIGHTG:";
  34          code unsigned char RGB_CODE_B[]="LIGHTB:";
  35          unsigned int key1_time=0;
  36          unsigned char RGB_CODE[12];
  37          char *ii;
  38          /*-------------------------------------------------------------------------------------------------------
  39          º¯ÊıÃû³Æ:
  40          void ini_rec_buff(void)
  41          º¯Êı¹¦ÄÜ:
  42          °Ñ½ÓÊÕ»º³åÇåÁã£¬ÉèÖÃ´®¿Ú½ÓÊÕ»úÖÆÎª³õÊ¼£¬´®¿ÚËÑË÷Ö¸ÕëÖ¸ÏòNULL
  43          ±»±¾º¯Êıµ÷ÓÃµÄº¯ÊıÇåµ¥:
  44          ÎŞ
  45          µ÷ÓÃ±¾º¯ÊıµÄº¯ÊıÇåµ¥:
  46          void main(void)
  47          ÊäÈë²ÎÊıËµÃ÷:
  48          ÎŞ
  49          Êä³ö²ÎÊıµÄËµÃ÷:
  50          ÎŞ
  51          º¯Êı·µ»ØÖµµÄËµÃ÷:
  52          ÎŞ
  53          ÆäËüËµÃ÷:
  54          Ã¿´Î´®¿ÚÊÕµ½Ò»´®Êı¾İ£¬ÒªÅĞ¶Ï´®¿Ú»º³åÇøÊÇ·ñ°üº¬¹Ø×¢µÄ×Ö·û´®£¬²¢Ïë³¹µ×Çå³ıÉÏ´Î½ÓÊÕµ½µÄ»º³å£¬µ÷ÓÃÕâ¸ö¡£
C51 COMPILER V9.00   MAIN                                                                  08/12/2015 08:22:17 PAGE 2   

  55          --------------------------------------------------------------------------------------------------------
  56          */
  57          void ini_rec_buff(void)
  58          {
  59   1        unsigned char len=0;  
  60   1        for(len=0;len<64;len++)
  61   1        recd_buf[len]=0;
  62   1        RX1_Cnt=0;
  63   1        uart_rec_date=1;
  64   1        uart_time_out=0;
  65   1        uart_rec_new=0;
  66   1        ii=NULL;
  67   1      }
  68          /*-------------------------------------------------------------------------------------------------------
  69          º¯ÊıÃû³Æ:
  70          void uptemp(void)
  71          º¯Êı¹¦ÄÜ:
  72          ½«ÎÂ¶ÈºÍÊª¶ÈĞÅÏ¢ ¾­¹ıWIFIÄ£¿é´®¿Ú£¬·¢ËÍµ½·şÎñÆ÷£¬·şÎñÆ÷×ª·¢¸ø¿ØÖÆÖÕ¶Ë£¬±ÈÈçÊÖ»ú»òÕßµçÄÔ
  73          ±»±¾º¯Êıµ÷ÓÃµÄº¯ÊıÇåµ¥:
  74          make_AT_SEND_LEN£¨£©£»//¶¯Ì¬Éú³É·¢ËÍÊı¾İ³¤¶ÈATÖ¸Áî¡£
  75          at_uart_send_str()        //¾­¹ı±¾º¯Êı·¢ËÍÎÂ¶ÈĞÅÏ¢
  76          read_dh();                        //¶ÁÈ¡DHT11µÄÎÂ¶ÈºÍÊª¶ÈĞÅÏ¢
  77          µ÷ÓÃ±¾º¯ÊıµÄº¯ÊıÇåµ¥:
  78          void main(void)
  79          ÊäÈë²ÎÊıËµÃ÷:
  80          ÎŞ
  81          Êä³ö²ÎÊıµÄËµÃ÷:
  82          ÎŞ
  83          º¯Êı·µ»ØÖµµÄËµÃ÷:
  84          ÎŞ
  85          ÆäËüËµÃ÷:
  86          --------------------------------------------------------------------------------------------------------
  87          */
  88          void uptemp(void)
  89          {
  90   1                  if(min_rech)                                     // ¶¨Ê±Æ÷ÖÃÎ»min_rechÃ¿·ÖÖÓ»áÖ´ĞĞµ½ÕâÀïÒ»´Î
  91   1                              {
  92   2                              min_rech=0;
  93   2                          need_seed_len=9;                                 
  94   2                          make_AT_SEND_LEN(need_seed_len,RMT_data);            //¶¯Ì¬¹¹Ôì·¢ËÍAT³¤¶ÈÖ¸Áî
  95   2                              at_uart_send_str(at_send_len_ox);                //·¢ËÍ¹¹ÔìºÃµÄ·¢ËÍÖ¸Áî
  96   2                          Delay2(1000);                       
  97   2                          at_uart_send_buf(temp_cd,need_seed_len);         //¾­¹ıWIFI¿ªÊ¼·¢ËÍÊı¾İ
  98   2                              LED2=0;
  99   2                              BEEP=1;
 100   2                              Delay2(200);
 101   2                          LED2=1;
 102   2                              BEEP=0;                                          //ÉÁÁÁĞÄÌøÖ¸Ê¾µÆ£¬ºÍĞÄÌøÒô
 103   2                                                                                               //Ã¿30Ãë»áÔËĞĞµ½ÕâÀïÒ»´Î¡£¸üĞÂÒ»´ÎÎÂ¶ÈÊıÖµ
 104   2                          RH_H++;
 105   2                              //read_dh();
 106   2                              temp_cd[5]=(((RH_H%100)/10)+'0');
 107   2                              temp_cd[6]=(((RH_H%10))+'0');
 108   2                          temp_cd[7]=((RH_L)+'0');
 109   2                              }                 
 110   1      }
 111          /*------------------------------------------------------------------------------------------------------
 112          º¯ÊıÃû³Æ:
 113          void ack_rgb_bar(unsigned char bar_mod)
 114          º¯Êı¹¦ÄÜ:
 115          Ä£¿é¾­¹ı·şÎñÆ÷»ØÓ¦ÖÕ¶ËÉè±¸±¾WIFIÄ£¿é¿ØÖÆµÄµÆ¾ßºìÂÌÀ¶µÄÊıÖµ¡£ÊÖ»ú»òÕßµçÄÔ£¬ÊÕµ½Ô¶³ÌÄ£¿é»ØÓ¦¹ıÀ´µÄÊıÖµ£¬²Å¸ü
             -ĞÂ½ø¶ÈÌõ
C51 COMPILER V9.00   MAIN                                                                  08/12/2015 08:22:17 PAGE 3   

 116          ±»±¾º¯Êıµ÷ÓÃµÄº¯ÊıÇåµ¥:
 117          make_AT_SEND_LEN£¨£©£»//¶¯Ì¬Éú³É·¢ËÍÊı¾İ³¤¶ÈATÖ¸Áî¡£
 118          at_uart_send_str()        //¾­¹ı±¾º¯Êı·¢ËÍ±¾µØ R G B µÄÊıÖµ£¬´Ó0-99
 119          µ÷ÓÃ±¾º¯ÊıµÄº¯ÊıÇåµ¥:
 120          void main(void)
 121          ÊäÈë²ÎÊıËµÃ÷:
 122          ÎŞ
 123          Êä³ö²ÎÊıµÄËµÃ÷:
 124          ÎŞ
 125          º¯Êı·µ»ØÖµµÄËµÃ÷:
 126          ÎŞ
 127          ÆäËüËµÃ÷:
 128          ±¾º¯ÊıÓÃÀ´»ØÀ¡±¾µØ×´Ì¬µ½ÊÖ»úAPPÉÏ£¬±ÈÈçÊÖ»úÍÏ¶¯ºìÉ«µÆ½ø¶ÈÌõµ½85%£¬Ä£¿é½«ÊÕµ½LIGHR:85,Ä£¿éµ÷ÕûºìÉ«µÆÁÁ¶Èµ½8
             -5%ºó£¬»ØÀ¡Ò»¸ö LIGHR:85¡£
 129          ÊÖ»úAPPÖªµÀÔ¶³ÌµÆ¾ßÒÑ¾­Ö´ĞĞÁË£¬ÓÚÊÇ¸úĞÂ±¾µØºìÉ«Í¨µÀ½ø¶ÈÌõµ½85%
 130          --------------------------------------------------------------------------------------------------------
 131          */
 132          void ack_rgb_bar(unsigned char bar_mod)
 133          {
 134   1          unsigned char a=0;
 135   1              unsigned char temp_bar=0;
 136   1              for(a=0;a<12;a++)
 137   1              RGB_CODE[a]=0;
 138   1              for(a=0;a<7;a++)
 139   1              {
 140   2                      if(bar_mod==1)
 141   2                      {
 142   3                      RGB_CODE[a]=RGB_CODE_R[a];
 143   3                      }
 144   2                      else if(bar_mod==2)
 145   2                      {
 146   3                      RGB_CODE[a]=RGB_CODE_G[a];
 147   3                      }
 148   2                      else if(bar_mod==3)
 149   2                      {
 150   3                      RGB_CODE[a]=RGB_CODE_B[a];
 151   3                      }
 152   2              }
 153   1          if(bar_mod==1)
 154   1          temp_bar=bar_r;
 155   1          else if(bar_mod==2)
 156   1          temp_bar=bar_g;
 157   1          else if(bar_mod==3)
 158   1          temp_bar=bar_b;
 159   1              if(temp_bar>=10)
 160   1              {
 161   2              RGB_CODE[7]=(temp_bar/10)+'0';
 162   2              RGB_CODE[8]=(temp_bar%10)+'0';
 163   2              RGB_CODE[9]=0x0d;
 164   2              RGB_CODE[10]=0x0a;
 165   2              need_seed_len=11;
 166   2              }
 167   1              else
 168   1              {
 169   2              RGB_CODE[7]=temp_bar+'0';
 170   2              RGB_CODE[8]=0x0d;
 171   2              RGB_CODE[9]=0x0a;
 172   2              need_seed_len=10;
 173   2              }
 174   1              make_AT_SEND_LEN(need_seed_len,RMT_data);                //¶¯Ì¬¹¹Ôì·¢ËÍATÖ¸Áî
 175   1              at_uart_send_str(at_send_len_ox);                //·¢ËÍ¹¹ÔìºÃµÄ·¢ËÍÖ¸Áî
 176   1              Delay2(50);
C51 COMPILER V9.00   MAIN                                                                  08/12/2015 08:22:17 PAGE 4   

 177   1              at_uart_send_buf(RGB_CODE,need_seed_len);            //¾­¹ıWIFI·¢ËÍÊı¾İ  
 178   1      }
 179          /*------------------------------------------------------------------------------------------------------
 180          º¯ÊıÃû³Æ:
 181          void main(void£©
 182          Ö÷º¯ÊıÖ÷ÒªÍê³É¹¦ÄÜÈçÏÂ£º
 183          1 ´ò¿ªWIFI¹©µç£¬²¢ÈÃ·äÃùÆ÷²»Ïì£¬³õÊ¼»¯¸÷¸ö±äÁ¿µ½Ä¬ÈÏÖµ¡£
 184          2 ³õÊ¼»¯´®¿Ú ÖĞ¶Ï  ºÍPWM ÒÔ¼°¶¨Ê±Æ÷
 185          3 ÅĞ¶ÏÉÏµçÊ±¿ÌÊÇ·ñKEY1 ±»°´ÏÂ£¬Èô±»°´ÏÂºóÔÚÏÂÃæ»·½Ú£¬½«½øÈëSMARTLINK ×´Ì¬£¬ÉèÖÃ±¾Ä£¿éÁ¬Èë¼ÒÍ¥Â·ÓÉÆ÷µÄÕË»§º
             -ÍÃÜÂëĞÅÏ¢
 186          4 ÒÀ´Î·¢ËÍËÄÌõATÖ¸Áî£¬ÈÃÄ£¿éÁ¬µ½ÔÆ·şÎñÆ÷ÉÏ£¬´Ó¶øÊÖ»ú¿ÉÒÔÔ¶³Ì¿ØÖÆÕâ¸öÄ£¿éÁË¡£
 187            at_uart_send_str(AT_MODE);             //ÉèÖÃÄ£¿é½øÈëSTATION Ä£Ê½
 188            at_uart_send_str(AT_SMARTLINK);        //·¢ËÍ½øÈëSMARTLINK ATÖ¸Áî£¬Ä£¿é¿ÉÓÃÀ´»ñÈ¡¼ÒÍ¥Â·ÓÉÆ÷ÕË»§ÃÜÂëÁ¬µ½»¥ÁªÍøÉ
             -Ï¡£
 189            at_uart_send_str(AT_CLDSTART);     //·ÃÎÊ°²ĞÅ¿ÉµÄÔÆ·şÎñÆ÷¼ÓÈë°²ĞÅ¿ÉÔÆ¡£
 190            at_uart_send_str(AT_LANSTART);     //´ËÃüÁî£¬ÈÃÄ£¿é¾­¹ı±¾µØ¾ÖÓòÍø£¬¼àÌı±¾µØÊÖ»ú·¢¹ıÀ´µÄ²éÑ¯ĞÅÏ¢£¬ÊÖ»ú»ñµ
             -ÃÕâ¸öÄ£¿éµÄĞÅÏ¢ºó£¬Õâ¸öÊÖ»ú¼´¿ÉÏò·şÎñÆ÷ÉêÇë¶ÔÕâ¸öÄ£¿é¿ØÖÆ£¡
 191          5 ½Ó×Å½øĞĞ´óÑ­»·ÁË£¬¾­¹ıÉÏÃæµÄ²½Öè£¬Ä£¿éÒÑ¾­½øÈë½ÓÊÜÔ¶³ÌÊÖ»ú¿ØÖÆµÄ×´Ì¬£¬ÔÚÕâ¸öÑ­»·ÖĞ£¬Ö»ÓÃ¹Ø×¢´®¿Ú¹ıÀ´µÄÊı
             -¾İ£¨Ô¶³ÌÊÖ»ú¾­¹ı·şÎñÆ÷·¢¹ıÀ´µÄ¿ØÖÆÖ¸Áî£©
 192            ±ÈÈç ¿ª¹Ø¼ÌµçÆ÷£¬ÉèÖÃºìÂÌÀ¶ LEDÁÁ¶ÈµÄÃüÁî£¬±¾»úÖ´ĞĞºó£¬»¹ĞèÒª¸æËßÊÖ»ú£ºÎÒÒÑ¾­°´ÕÕÄãµÄÃüÁîÖ´ĞĞÁË£¡ Í¬Ê±Ã¿
             -·ÖÖÓ»¹Òª°Ñ±¾µØÎÂ¶È Êª¶È ¾­¹ı·şÎñÆ÷ ·¢ËÍ¸øÔ¶³ÌÊÖ»úAPPÉÏÏÔÊ¾£¡
 193            ÁíÍâÔÚÖ÷Ñ­»·ÖĞ£¬»¹°üº¬Ò»¸ö³¤°´KEY2 5Ãëºó£¬Ä£×é¸øÔÆ¶Ë·şÎñÆ÷·¢ËÍ½â°óÖ¸Áî£¬Ö÷¶¯ºÍÕâ¸öÊÖ»ú½â³ı°ó¶¨¡£
 194          --------------------------------------------------------------------------------------------------------
 195          */
 196          void main(void)
 197          {
 198   1              char z=0;
 199   1              unsigned int h=0;
 200   1              WIFI_VCC=0;                //WIFI µçÔ´ÊÜµ¥Æ¬»ú¿ØÖÆ£¬ÔÚÒì³£µÄÊ±ºò£¬µ¥Æ¬»ú¿ÉÒÔÇ¿ÖÆÖØÆô¶¯ESP8266
 201   1              init_uart();       // ³õÊ¼»¯´®¿Ú²¨ÌØÂÊºÍESP8266 ´®¿ÚÄ£×éÏàÍ¬¡£
 202   1              BEEP=0;                    //¹Øµô·äÃùÆ÷
 203   1              Delay2(1000);      //ÑÓ³ÙÆô¶¯£¬ÈÃÏµÍ³¸üÎÈ¶¨
 204   1              old_bar_r=bar_r;   //³õÊ¼»¯ºìÂÌÀ¶ µÆµÄPWM Õ¼¿Õ±È0-99
 205   1              old_bar_g=bar_g;
 206   1              old_bar_b=bar_b;
 207   1              PWM(1,1,1);                //ÈÃÈı¸öµÆÎ¢ÁÁ
 208   1              timer0_ini();      //³õÊ¼»¯¶¨Ê±0£¬ÎªÒ»Ğ©ĞèÒªÊ±¼ä»ù×¼·şÎñµÄ¶«Î÷×ö×¼±¸¡£
 209   1              if(K1==0)           //¿ª»úµÄÊ±ºò·¢ÏÖ°´¼ü1Ò²¾ÍÊÇMCU_P1.3 ±»°´ÏÂ£¬ÄÇÃ´ÖØĞÂÓÃATÖ¸ÁîÅäÖÃWIFIÄ£¿éÁ¬Â·ÓÉÆ÷µÄÉÏÍ
             -øÕË»§ºÍÃÜÂë
 210   1              {
 211   2                              LED2=0;
 212   2                              BEEP=1;
 213   2                              Delay2(500);
 214   2                          LED2=1;
 215   2                              BEEP=0;      //ÉÁÁÁĞÄÌøÖ¸Ê¾µÆ£¬ºÍĞÄÌøÒô
 216   2                              
 217   2                              have_config=1;
 218   2              }        
 219   1                      at_uart_send_str(AT_MODE);               //ÉèÖÃÄ£¿é½øÈëSTATION Ä£Ê½
 220   1                  Delay2(500);
 221   1                  ini_rec_buff();     
 222   1                      if(have_config)                                  //ĞèÒªÅäÖÃ Ä£¿éÁ¬Èë±¾µØµÄÂ·ÓÉÆ÷ÕË»§ºÍÃÜÂë
 223   1                      { 
 224   2                      at_uart_send_str(AT_SMARTLINK);  //·¢ËÍ½øÈëSMARTLINK ATÖ¸Áî
 225   2                      Delay2(500);
 226   2                      }
 227   1                      do                                                               //´ËÑ­»·Íê³ÉSMARTLINK µÄÅäÖÃ
 228   1                      {
 229   2                      BEEP=1;
 230   2                      Delay2(500);
 231   2                      BEEP=0;
 232   2                      Delay2(500);
C51 COMPILER V9.00   MAIN                                                                  08/12/2015 08:22:17 PAGE 5   

 233   2                  }while(strstr(recd_buf,smartlink_code)==NULL); //´ËÑ­»·Íê³ÉSMARTLINK µÄÅäÖÃ
 234   1                      uart_rec_new=0;
 235   1                      at_uart_send_str(AT_CLDSTART); //¼ÓÈë°²ĞÅ¿ÉÔÆ
 236   1                      Delay2(1000);
 237   1                      at_uart_send_str(AT_LANSTART);//¿ªÆôÄÚÍøÄ£Ê½£¨´ËÄ£Ê½ÏÂ£¬Ä£×é»áÓÃÄÚÍø»ØÓ¦ÊÖ»úAPP Òª²éÑ¯µÄID ºÍKEY£©
 238   1                      Delay2(500);
 239   1                      while(1)
 240   1                      {  
 241   2                      if(have_change_pwm)                  //¶¨Ê±Æ÷ÖÃÎ»ºó£¬10ºÁÃë½øÈëÒ»´Î ¼ÙÈçÔÚÑ­»·ÖĞ¼ì²âµ½ĞèÒª¸Ä±äR G B µÆµÄ±ä»¯¡£Ã¿10M
             -S ¼Ó1»òÕß¼õ1 PWMÊıÖµ£¬´Ó×î°µµ½×îÁÁĞèÒª2.56Ãë
 242   2                      {                                                        //ÕâÀïÓÃÀ´×ö½¥ÁÁ»òÕß½¥ÃğĞ§¹û
 243   3                           have_change_pwm=0;          //Çå±êÖ¾
 244   3                               if(K1==0)                               //¼ÙÈçK1±»°´ÏÂ£¬¼ÇÂ¼°´ÏÂµÄÊ±¼ä³¤¶Ì¡£
 245   3                           key1_time++;
 246   3                           else
 247   3                           key1_time=0;
 248   3                           if(key1_time>500)       //K1 ±»Á¬Ğø°´ÏÂ³¬¹ı5Ãë
 249   3                           {
 250   4                            key1_time=0;
 251   4                            at_uart_send_str(AT_CUB); //³¬¹ı5Ãëºó£¬Ä£×é¾­¹ıATÖ¸ÁîÏò·şÎñÆ÷·¢³öÍË³ö¼ÒÍ¥×éÃüÁî
 252   4                            BEEP=1;
 253   4                            Delay2(100);                              //·äÃùÆ÷ÏìÈıÉù£¬´ú±íÄ£¿éÒÑ¾­ÓëÕâ¸öÕËºÅ½â°ó
 254   4                            BEEP=0;
 255   4                            Delay2(100);
 256   4                            BEEP=1;
 257   4                                Delay2(100);
 258   4                            BEEP=0;
 259   4                            Delay2(100);
 260   4                            BEEP=1;
 261   4                            Delay2(100);
 262   4                            BEEP=0;
 263   4                         } 
 264   3                               if(bar_r>old_bar_r)//bar_r Õâ¸ö±äÁ¿ÖĞ¼ÇÂ¼ÁË×îĞÂ´ÓWIFIÄ£¿é´®¿Ú»ñµÃµÄPWMÊıÖµ£¬Èô·¢ÏÖºÍ¾ÉµÄPWMÊıÖµÓĞ³öÈ
             -ë£¬ËµÃ÷ĞèÒª¸Ä±ä£¡ÄÇ¾Í°ÑÀÏµÄ¼ÇÂ¼Éı1»òÕß½µ1
 265   3                               {                                                                                         
 266   4                                 old_bar_r++;
 267   4                                 set_pwm(old_bar_r,old_bar_g,old_bar_b);//ÉèÖÃ¼Ó1ºóµÄPWMµ½PWM¼Ä´æÆ÷ÖĞ£¬µÆµÄÁÁ¶È»á±ä»¯
 268   4                               }
 269   3                               else if(bar_r<old_bar_r)//bar_r Õâ¸ö±äÁ¿ÖĞ¼ÇÂ¼ÁË×îĞÂ´ÓWIFIÄ£¿é´®¿Ú»ñµÃµÄPWMÊıÖµ£¬Èô·¢ÏÖºÍ¾ÉµÄPWMÊıÖµÓĞ
             -³öÈë£¬ËµÃ÷ĞèÒª¸Ä±ä£¡ÄÇ¾Í°ÑÀÏµÄ¼ÇÂ¼Éı1»òÕß½µ1
 270   3                               {
 271   4                                 old_bar_r--;
 272   4                                 set_pwm(old_bar_r,old_bar_g,old_bar_b);
 273   4                               }
 274   3                               if(bar_g>old_bar_g)
 275   3                               {
 276   4                                 old_bar_g++;
 277   4                                 set_pwm(old_bar_r,old_bar_g,old_bar_b);
 278   4                               }
 279   3                               else if(bar_g<old_bar_g)
 280   3                               {
 281   4                                 old_bar_g--;
 282   4                                 set_pwm(old_bar_r,old_bar_g,old_bar_b);
 283   4                               }
 284   3                               if(bar_b>old_bar_b)
 285   3                               {
 286   4                                 old_bar_b++;
 287   4                                 set_pwm(old_bar_r,old_bar_g,old_bar_b);
 288   4                               }
 289   3                               else if(bar_b<old_bar_b)
 290   3                               {
 291   4                                 old_bar_b--;
C51 COMPILER V9.00   MAIN                                                                  08/12/2015 08:22:17 PAGE 6   

 292   4                                 set_pwm(old_bar_r,old_bar_g,old_bar_b);
 293   4                               }
 294   3                      }       
 295   2                      if(uart_rec_new)//Õâ¸ö±êÖ¾Î»Îª1£¬´ú±íWIFI ÊÕµ½Êı¾İ´Ó´®¿ÚÊä³öµ½MCUµÄ´®¿Ú»º³åÇøÁË£¬²¢ÇÒ¹¹³ÉÒ»Ğ¡¶Î£¬¿ÉÒÔ·ÖÎ
             -öÁË¡£¶¨Ê±Æ÷¼ÆÊ±£¬´ÓÊÕµ½´Ó´®¿Ú×îºóÒ»¸ö×Ö½Ú¿ªÊ¼10MS£¬ÈôÃ»ÓĞĞÂÊı¾İµ½À´¡£¾ÍËãÒ»Õû¶Î½áÊø£¡
 296   2                      {
 297   3                       if((ii=strstr(recd_buf,PCLD_code))!=NULL) // strstrÕâ¸öº¯ÊıÊÇKEIL±àÒëÆ÷µÄ×Ö·û´®¿âº¯Êı£¬¹¦ÄÜÊÇ´ÓÒ»¸ö×Ö·û
             -´®ÖĞ²éÕÒÊÇ·ñ´æÔÚÖ¸¶¨µÄ×Ö·û´®£¬Ã»ÕÒµ½·µ»ØNULL£¬ÕÒµ½ºó·µ»ØÕÒµ½µÄÎ»ÖÃ£¬¾ÍÊÇÖ¸Õë£¡
 298   3                       {                                                                                 // ÕÒµ½LIGHT: ÕâÑùµÄ×Ö·û´®´æÔÚÓÚ´®¿Ú»º³åÇøÖĞ
 299   4                              if(*(ii+6)=='0')                                           //  LIGHT:0 ÅĞ¶Ï×îºóÒ»¸ö×Ö·û£¬ÊÇ0´ú±íÒª¹Ø¼ÌµçÆ÷
 300   4                              {
 301   5                    DK1=0;                                            //¹Øµô¼ÌµçÆ÷
 302   5                                need_seed_len=8;              //¹¹ÔìÉÏ´«Êı¾İµ½ÔÆ£¬×ª¸øÊÖ»úµÄÎÂ¶ÈÊı¾İ°ü£¬·ûºÏ»ù±¾Êı¾İ¸ñÊ½
 303   5                                make_AT_SEND_LEN(need_seed_len,RMT_data);                                      //¶¯Ì¬¹¹Ôì·¢ËÍATÖ¸Áî
 304   5                                at_uart_send_str(at_send_len_ox);                //·¢ËÍ¹¹ÔìºÃµÄ·¢ËÍÖ¸Áî
 305   5                                Delay2(50);
 306   5                                at_uart_send_buf(switch_sta0,need_seed_len);       //¾­¹ıWIFI·¢ËÍÊı¾İ
 307   5                                ///////////////////////////ÉÏÃæµÄ¼¸¸öAT·¢ËÍº¯Êı£¬°ÑÒÑ¾­¹Øµô¼ÌµçÆ÷µÄÏûÏ¢Í¨¹ı·şÎñÆ÷¸æËßAPP£¡APPÊÕµ½ºó°Ñ
             -½çÃæÉÏµÄµÆÉèÖÃÎª»ÒÉ«¹Ø±Õ×´Ì¬
 308   5                                Delay2(20);
 309   5                                bar_r=0;
 310   5                                bar_g=0;
 311   5                                bar_b=0;           //µãAPP¹ØµÆ×´Ì¬£¬°Ñ±¾µØµÄR G BÈı¸öµÆµÄPWMµÄÕ¼¿Õ±È È«ÉèÖÃÎª0
 312   5                                ack_rgb_bar(1);
 313   5                                ack_rgb_bar(1);
 314   5                                ack_rgb_bar(2);
 315   5                                Delay2(50);
 316   5                                ack_rgb_bar(3);//ÉÏÃæ¼¸¸öack_rgb_bar º¯Êı£¬°Ñ±¾µØRGB µÄÕ¼¿Õ±È¾­¹ıÔÆ·şÎñÆ÷·´À¡¸øÊÖ»úAPP£¬ÈÃÊÖ»úAPP¸üĞÂ
             -ÍÏ¶¯Ìõ
 317   5                                Delay2(50);
 318   5                              }
 319   4                              if(*(ii+6)=='1')                                      //  LIGHT:1 ÅĞ¶Ï×îºóÒ»¸ö×Ö·û£¬ÊÇ0´ú±íÒª¿ª¼ÌµçÆ÷
 320   4                              {
 321   5                    DK1=1;
 322   5                                need_seed_len=8;              //¹¹ÔìÉÏ´«Êı¾İµ½ÔÆ£¬×ª¸øÊÖ»úµÄÎÂ¶ÈÊı¾İ°ü£¬·ûºÏ»ù±¾Êı¾İ¸ñÊ½
 323   5                                make_AT_SEND_LEN(need_seed_len,RMT_data);                                      //¶¯Ì¬¹¹Ôì·¢ËÍATÖ¸Áî
 324   5                                at_uart_send_str(at_send_len_ox);                  //·¢ËÍ¹¹ÔìºÃµÄ·¢ËÍÖ¸Áî
 325   5                                Delay2(20);
 326   5                                at_uart_send_buf(switch_sta1,need_seed_len);       //¾­¹ıWIFI·¢ËÍÊı¾İ 
 327   5                                Delay2(50);
 328   5                                bar_r=99;
 329   5                                bar_g=99;
 330   5                                bar_b=99;
 331   5                                ack_rgb_bar(1);
 332   5                                ack_rgb_bar(1);
 333   5                                ack_rgb_bar(2);
 334   5                                Delay2(50);
 335   5                                ack_rgb_bar(3);
 336   5                                Delay2(50);
 337   5                              }
 338   4                              ini_rec_buff();
 339   4                              uart_rec_new=0;
 340   4                       }
 341   3                       else if(((ii=strstr(recd_buf,LIGHTR_code))!=NULL)&&(old_bar_r==bar_r)) //ÔÚ´®¿Ú»º³åÇøÖĞ£¬ÕÒµ½LIGHTR:XX 
             -ÕâÑùÉèÖÃºìÂÌÀ¶PWM µÄ×Ö·û´®ÃüÁî
 342   3                       {                                                                                                                                              //µ±ĞÂ¾ÉPWMÊıÖµÏàÍ¬£¬Ò²¾ÍÊÇÉÏ´Î²Ù×÷µÄÁÁ¶ÈPWM½¥±ä¹ı³ÌÍê³Éºó£¨old_bar_r==bar_r)²ÅÔÊĞí½
             -øĞĞ
 343   4                         old_bar_r=bar_r;                                                                                                             
 344   4                         if((*(ii+8)==0)||(*(ii+8)==0x0d))
 345   4                         bar_r=(*(ii+7)-'0');
 346   4                         else if((*(ii+9)==0)||(*(ii+9)==0x0d))
 347   4                         bar_r=(*(ii+7)-'0')*10+(*(ii+8)-'0');  //ÉÏÃæµÄÓï¾ä¹ıÈ¥³öLIGHTR;XX ÖĞ°ÑXXÕâ¸ö×Ö·û£¬±ä³ÉÊı×Ö£¡È»ºó²ÅÄÜ
C51 COMPILER V9.00   MAIN                                                                  08/12/2015 08:22:17 PAGE 7   

             -¸øPWM¸³Öµ
 348   4                         ack_rgb_bar(1);                                                //Ä£¿é»ØÓ¦ĞÅÏ¢¸øÔ¶³ÌÊÖ»úÉÏµÄAPP ¸üĞÂ½ø¶ÈÌõ
 349   4                       }
 350   3                       else if(((ii=strstr(recd_buf,LIGHTG_code))!=NULL)&&(old_bar_g==bar_g))
 351   3                       {
 352   4                         old_bar_g=bar_g;
 353   4                         if((*(ii+8)==0)||(*(ii+8)==0x0d))
 354   4                         bar_g=(*(ii+7)-'0');
 355   4                         else if((*(ii+9)==0)||(*(ii+9)==0x0d))
 356   4                         bar_g=(*(ii+7)-'0')*10+(*(ii+8)-'0');
 357   4                         ack_rgb_bar(2);
 358   4                       }
 359   3                       else if(((ii=strstr(recd_buf,LIGHTB_code))!=NULL)&&(old_bar_b==bar_b))
 360   3                       {
 361   4                         
 362   4                         old_bar_b=bar_b;
 363   4                         if((*(ii+8)==0)||(*(ii+8)==0x0d))
 364   4                         bar_b=(*(ii+7)-'0');
 365   4                         else if((*(ii+9)==0)||(*(ii+9)==0x0d))
 366   4                         bar_b=(*(ii+7)-'0')*10+(*(ii+8)-'0');
 367   4                         ack_rgb_bar(3);
 368   4                       }
 369   3                       ini_rec_buff(); //Ã¿´ÎÅĞ¶ÏÍêºó£¬ÇåÉ¨´®¿Ú»º³åÇø ºÍ½ÓÊÕÍê³É±êÖ¾
 370   3                       uart_rec_new=0;
 371   3                      }
 372   2                      uptemp();                //¿´ÊÇ·ñĞèÒª¸üĞÂÎÂ¶ÈĞÅÏ¢
 373   2                 }
 374   1      }
 375          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1700    ----
   CONSTANT SIZE    =    503    ----
   XDATA SIZE       =     67       3
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =     96    ----
   BIT SIZE         =     10    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
